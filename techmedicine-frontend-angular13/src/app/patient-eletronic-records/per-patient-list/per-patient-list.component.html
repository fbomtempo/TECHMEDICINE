<div *ngIf="patients$ | async as patients; else loadingError">
  <div class="row">
    <div class="pt-4 pb-md-0 pb-3 col-md-3">
      <a class="fs-5 display-1 back" (click)="onHome()"
        ><i class="fas fa-home"></i><span class="ms-2">Home</span></a
      >
    </div>
    <h1 class="text-center pb-5">Prontuário Eletrônico do Paciente</h1>
  </div>
  <div class="row">
    <div class="col-12 mt-md-0 mt-2">
      <div class="d-flex">
        <input
          class="form-control"
          type="search"
          placeholder="Digite o nome do paciente"
          aria-label="Search"
          id="search"
          [(ngModel)]="filter"
          (input)="onFilterInput()"
        />
        <button
          type="button"
          class="btn btn-clear clear ms-2"
          (click)="clearFilter()"
        >
          Limpar
        </button>
      </div>
    </div>
    <div class="col-12">
      <div class="list-group pt-5" *ngIf="filter">
        <div *ngIf="showData(patients).length > 0; else noPatientFound">
          <a
            *ngFor="
              let patient of showData(patients) | pagination: page:itemsPerPage
            "
            [routerLink]="['paciente/', patient.id]"
            class="list-group-item list-group-item-action mb-3"
            aria-current="true"
          >
            <h6 style="font-weight: bold; text-transform: uppercase">
              {{ patient.name + " " + patient.surname }}
            </h6>
            <div class="text-muted">CPF: {{ patient.cpf }}</div>
            <div class="text-muted">Nascimento: {{ patient.birthDate }}</div>
          </a>
        </div>
      </div>
    </div>
    <div class="mb-3 d-flex justify-content-center">
      <pagination
        *ngIf="filter && showData(patients).length > 0"
        [totalItems]="showData(patients).length"
        [maxSize]="paginationSize"
        [itemsPerPage]="itemsPerPage"
        (pageChanged)="pageChanged($event)"
        [(ngModel)]="currentPage"
        [boundaryLinks]="true"
        previousText="&lsaquo;"
        nextText="&rsaquo;"
        firstText="&laquo;"
        lastText="&raquo;"
      >
      </pagination>
      <br />
    </div>
  </div>
</div>

<ng-template #loadingError>
  <div *ngIf="error | async; else loading">
    <div
      style="height: 80vh"
      class="d-flex flex-column align-items-center justify-content-center"
    >
      <p style="font-size: 1.65rem">Erro ao carregar pacientes.</p>
      <button
        type="button"
        class="btn btn-lg btn-secondary"
        (click)="reloadPage()"
      >
        Tentar Novamente <i class="fas fa-sync-alt"></i>
      </button>
    </div>
  </div>
</ng-template>

<ng-template #loading>
  <div
    style="height: 80vh"
    class="d-flex align-items-center justify-content-center"
  >
    <div class="loader"></div>
  </div>
</ng-template>

<ng-template #noPatientFound>
  <div class="text-center"><strong>Nenhum paciente encontrado.</strong></div>
</ng-template>
